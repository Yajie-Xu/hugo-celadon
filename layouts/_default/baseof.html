<!DOCTYPE html>
<html lang="{{ site.Language.LanguageCode | default `en` }}">
  <head>
    {{ partial "head.html" . }}
  </head>
  <body data-theme="light">
    <div class="page-shell">
      <nav class="morandi-nav">
        <div class="brand">
          <span class="dot"></span>
          <a href="{{ site.BaseURL }}">{{ site.Title }}</a>
        </div>
        <div class="nav-links">
          <a href="{{ site.BaseURL }}">Home</a>
          {{ range $section := site.Params.homepage.sections }}
            {{ $sectionStr := printf "%v" $section }}
            {{ $sectionLc := lower $sectionStr }}
            {{ $config := default dict (index site.Params.homepage $sectionStr) }}
            {{ $enabled := cond (and $config (isset $config "enable")) $config.enable true }}
            {{ if $enabled }}
              {{ $label := default (humanize $sectionStr) $config.title }}
              <a href="{{ printf "#%s" $sectionLc | absURL }}">{{ $label }}</a>
            {{ end }}
          {{ end }}
        </div>
        <button class="theme-toggle" data-theme-toggle aria-label="Toggle theme">
          <span class="icon" data-icon-sun>☼</span>
          <span class="icon" data-icon-moon>☾</span>
        </button>
      </nav>

      <main class="main-container">
        {{ block "main" . }}{{ end }}
      </main>

      {{ partial "footer.html" . }}
    </div>

    {{ partial "foot/scripts.html" . }}

    <button id="scroll-top" aria-label="Go to Top">↑</button>
    
    <script>
      (function () {
        const runMath = () => {
          if (typeof renderMathInElement === "function") {
            renderMathInElement(document.body, {
              delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true },
              ],
              throwOnError: false,
            });
          }
        };

        window.addEventListener("load", runMath);

        document.querySelectorAll(".highlight").forEach(function (highlight) {
          const codeBlock = highlight.querySelector("td.lntd:last-child pre code");
          if (!codeBlock) return;

          const langClass = Array.from(codeBlock.classList).find((cls) =>
            cls.startsWith("language-")
          );
          const label = langClass ? langClass.replace("language-", "").toUpperCase() : "CODE";

          const frame = document.createElement("div");
          frame.className = "code-frame";

          const header = document.createElement("div");
          header.className = "code-frame__header";
          const langTag = document.createElement("span");
          langTag.className = "code-frame__lang";
          langTag.textContent = label;
          header.appendChild(langTag);

          const button = document.createElement("button");
          button.className = "copy-btn";
          button.ariaLabel = "Copy code";
          const iconClipboard = `
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
          `;
          const iconCheck = `
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          `;
          button.innerHTML = iconClipboard;
          header.appendChild(button);

          const body = document.createElement("div");
          body.className = "code-frame__body";
          frame.appendChild(header);
          frame.appendChild(body);

          const parent = highlight.parentNode;
          highlight.classList.add("code-frame__table");
          parent.replaceChild(frame, highlight);
          body.appendChild(highlight);

          button.addEventListener("click", function () {
            navigator.clipboard.writeText(codeBlock.innerText).then(function () {
              button.classList.add("copied");
              button.innerHTML = iconCheck;
              setTimeout(function () {
                button.classList.remove("copied");
                button.innerHTML = iconClipboard;
              }, 2000);
            });
          });
        });
      })();
      (function () {
        const btn = document.getElementById("scroll-top");
        if (!btn) return;
        window.addEventListener("scroll", () => {
          if (window.scrollY > 300) {
            btn.classList.add("show-scroll");
          } else {
            btn.classList.remove("show-scroll");
          }
        });
        btn.addEventListener("click", () => {
          window.scrollTo({ top: 0, behavior: "smooth" });
        });
      })();
    </script>
  </body>
</html>
