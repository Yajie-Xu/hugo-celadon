{{ $section := .Section }}
{{ $config := .Config }}
{{ $title := default (humanize $section) $config.title }}
{{ $items := .Data }}
{{ if not $items }}
  {{ $items = slice }}
{{ end }}
{{ if and (reflect.IsMap $items) (isset $items "sparks") }}
  {{ $items = index $items "sparks" }}
{{ end }}
<section id="{{ $section }}" class="writing-grid section-block">
  <div class="section-heading">
    <span class="bar"></span>
    <div><h2>{{ $title }}</h2></div>
  </div>
  <div class="card-grid {{ if eq $section "misc" }}misc-grid{{ end }}">
    {{ range $items }}
      {{ $link := default "#" (or .link .url) }}
      {{ $image := strings.TrimPrefix "/" .image }}
      {{ if and (hasPrefix $link "/") (not (hasPrefix $link "//")) }}
        <a class="category-card" href="{{ $link | relURL }}" style="background-image: url('{{ $image | relURL }}')">
      {{ else }}
        <a class="category-card" href="{{ $link | safeURL }}" target="_blank" rel="noopener" style="background-image: url('{{ $image | relURL }}')">
      {{ end }}
        <div class="overlay">
          <h3>{{ .name }}</h3>
          <p>{{ .description }}</p>
        </div>
      </a>
    {{ end }}
  </div>
</section>
