{{- $items := .items -}}
{{- $limit := or .limit (len $items) -}}
<div class="collapsible" data-expandable data-limit="{{ $limit }}">
  <div class="expandable-grid" data-expandable-content>
    {{ range $items }}
      <article class="expandable-card">
        {{ $img := strings.TrimPrefix "/" .image }}
        <div class="card-image">
          <img src="{{ $img | relURL }}" alt="{{ .title }} thumbnail" loading="lazy">
        </div>
        <div class="card-content">
          {{ with .meta }}<p class="card-meta">{{ . }}</p>{{ end }}
          <h3>{{ .title }}</h3>
          {{ with .summary }}<p class="card-summary">{{ . }}</p>{{ end }}
          {{ with .tags }}
            <div class="tag-row">
              {{ range . }}
                <span class="tag">{{ . }}</span>
              {{ end }}
            </div>
          {{ end }}
        </div>
        <div class="card-footer">
          {{ range .links }}
            {{ $link := .url }}
            {{ $isExternal := or (strings.HasPrefix $link "http://") (strings.HasPrefix $link "https://") }}
            {{ $href := cond $isExternal $link ($link | relURL) }}
            <a class="chip-link" href="{{ $href }}" {{ if $isExternal }}target="_blank" rel="noopener"{{ end }}>{{ .label }}</a>
          {{ end }}
        </div>
      </article>
    {{ end }}
  </div>
  {{ if gt (len $items) $limit }}
    <button class="ghost-toggle" type="button" data-expand-toggle>Show More â†“</button>
  {{ end }}
</div>
