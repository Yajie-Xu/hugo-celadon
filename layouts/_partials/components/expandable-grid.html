{{- $items := .items -}}
{{- $limit := or .limit (len $items) -}}
<div class="collapsible" data-expandable data-limit="{{ $limit }}">
  <div class="expandable-grid" data-expandable-content>
    {{ range $items }}
      <article class="expandable-card">
        {{ $img := strings.TrimPrefix "/" .image }}
        <div class="card-image">
          <img src="{{ $img | relURL }}" alt="{{ .title }} thumbnail" loading="lazy">
        </div>
        <div class="card-content">
          {{ with .meta }}<p class="card-meta">{{ . }}</p>{{ end }}
          <h3>{{ .title }}</h3>
          {{ with .summary }}<p class="card-summary">{{ . }}</p>{{ end }}
          {{ $coLabel := or .coauthors_label .coauthorsLabel "Co-authors" }}
          {{ with .coauthors }}
            <p class="card-coauthors">
              <span class="label">{{ $coLabel }}:</span>
              <span class="coauthor-list">
                {{ range $index, $co := . }}
                  {{ if gt $index 0 }}, {{ end }}
                  {{ $name := $co.name | default $co.title | default $co.label }}
                  {{ $link := or $co.url $co.link }}
                  {{ if $link }}
                    {{ if and (hasPrefix $link "/") (not (hasPrefix $link "//")) }}
                      <a class="coauthor-link" href="{{ $link | relURL }}">{{ $name }}</a>
                    {{ else }}
                      <a class="coauthor-link" href="{{ $link | safeURL }}" target="_blank" rel="noopener">{{ $name }}</a>
                    {{ end }}
                  {{ else }}
                    <span class="coauthor-name">{{ $name }}</span>
                  {{ end }}
                {{ end }}
              </span>
            </p>
          {{ end }}
          {{ with .tags }}
            <div class="tag-row">
              {{ range . }}
                <span class="tag">{{ . }}</span>
              {{ end }}
            </div>
          {{ end }}
        </div>
        <div class="card-footer">
          {{ range .links }}
            {{ $dest := or .link .url }}
            {{ if and (hasPrefix $dest "/") (not (hasPrefix $dest "//")) }}
              <a class="chip-link" href="{{ $dest | relURL }}">{{ .label }}</a>
            {{ else }}
              <a class="chip-link" href="{{ $dest | safeURL }}" target="_blank" rel="noopener">{{ .label }}</a>
            {{ end }}
          {{ end }}
        </div>
      </article>
    {{ end }}
  </div>
  {{ if gt (len $items) $limit }}
    <button class="ghost-toggle" type="button" data-expand-toggle>Show More â†“</button>
  {{ end }}
</div>
